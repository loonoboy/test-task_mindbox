# Тестовое задание Mindbox

Здесь я дополнительно написал, почему сделал именно так
---

## Как я думал и искал решения

Делал следующим образом: читал документацию Kubernetes, статьи и примеры в интернете, потом пробовал понять, как это применить к задаче

### Реплики
В условии написано, что 4 пода справляются с нагрузкой, следовательно я поставил также 4
Также нашёл хорошую практику, что лучше добавить авто-масштабирование (HPA), чтобы ночью подов было меньше, а днём больше 

### CPU и память
Из задания: в обычной работе ~0.1 CPU и 128М памяти
Но приложение стартует тяжело, ему нужно больше CPU, поэтому я сделал `requests.cpu = 200m`, а `limits.cpu = 500m`
Для памяти оставил `128Mi` запрос и `256Mi` лимит
Это даст нам запас на старте, а потом потребление будет стабильно маленьким

### Probes (проверки)
Нашёл, что есть `readinessProbe` и `livenessProbe`
- `readinessProbe` я сделал с задержкой 10 секунд, потому что приложение запускается 5–10 секунд, взял максимальную задержку 
- `livenessProbe` добавил, чтобы под перезапускался, если он завис

### Отказоустойчивость
Прочитал, что если кластер мультизональный, то лучше распределять поды по зонам, для этого есть `podAntiAffinity` 
Сделал так, чтобы поды не собирались все в одной зоне,потомку что тогда если одна зона упадёт, приложение продолжит работать(best practice)

### Service
Я сделал сервис `ClusterIP` как дефолт, в условии не сказано про внешний доступ, но решил реализовать
Но если бы нужен был доступ снаружи, то можно было бы сделать `LoadBalancer` например, мне он поаказался один из лучших вариантов

### Autoscaler
Сделал HPA:  
- минимум 2 пода (чтобы ночью не было пусто и приложение не приходилось заново поднимать с тяжёлым стартом)
- максимум 6 подов (немного больше 4, чтобы был запас)
- триггер по CPU на 60% (прочитал, что обычно ставят от 50 до 70)

### PodDisruptionBudget
Добавил PDB, потому что при обновлении или сбое всегда останется хотя бы 2 пода, а это повышает надёжность

---

## Что получилось
- Приложение стартует плавно (readinessProbe ждёт).  
- Поды равномерно распределяются по зонам.  
- Ночью работает меньше подов, днём — больше.  
- Минимальные ресурсы тратятся, но запас на старте есть.  
- При обновлениях и сбоях всегда остаются работающие поды.

---

## Что я гуглил

Я читал и документацию Kubernetes, и статьи на Medium/Habr

---

## Вывод
Для меня это было как маленькое приключение
Я впервые собрал такой манифест с Deployment, Service, HPA и PDB
Понял, что Kubernetes — мегакрутая вещь, сталкивался с ней при разработке, но так глубоко капнуть оказалось увлекательно
